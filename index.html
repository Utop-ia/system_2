<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simulatore di Risonanza</title>
    <link rel="stylesheet" href="style.css" />
    <script src="p5.min.js" defer></script>
    <script src="CCapture.all.min.js" defer></script>
    <script src="sketch.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.7.76/build/pdf.min.js" defer></script>
    <script defer>window.addEventListener("DOMContentLoaded",()=>{if(window.pdfjsLib){pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.7.76/build/pdf.worker.min.js";}});</script>
  </head>
  <body>
    <main id="app-container">
      <div id="canvas-container"></div>
      <aside id="ui-sidebar">
        <header>
          <h1>Risonanza</h1>
          <p>Simulatore di onde</p>
        </header>

        <div class="ui-panel">
          <h2 class="panel-header active">Aspetto</h2>
          <div class="panel-content show">
            <div class="preset-group">
              <label for="preset-select">Seleziona un'aspetto</label>
              <select id="preset-select"></select>
              <button id="apply-preset-btn">Applica aspetto</button>
            </div>
          </div>
        </div>

        <div class="ui-panel">
          <h2 class="panel-header active">Animazioni</h2>
          <div class="panel-content show">
            <div class="preset-group">
              <label for="animation-preset-select"
                >Animazioni predefinite</label
              >
              <select id="animation-preset-select"></select>
            </div>
            <div class="preset-group">
              <label for="user-animation-select">Le tue animazioni</label>
              <div class="animation-controls">
                <select id="user-animation-select"></select>
                <div class="manage-buttons">
                  <button id="rename-animation-btn" disabled>Rinomina</button>
                  <button id="delete-animation-btn" disabled>Elimina</button>
                </div>
              </div>
            </div>
            <div class="preset-group">
              <button id="play-animation-btn">Avvia</button>
            </div>
            <div
              class="preset-group"
              style="
                border-top: 1px solid var(--border-color);
                padding-top: 20px;
              "
            >
              <label for="record-animation-btn">Crea la tua animazione</label>
              <button id="record-animation-btn">
                Registra nuova animazione
              </button>
              <p
                id="record-status"
                style="
                  font-size: 12px;
                  color: var(--danger-color);
                  margin-top: 10px;
                  text-align: center;
                  height: 15px;
                "
              ></p>
            </div>
          </div>
        </div>

        <div class="ui-panel">
          <h2 class="panel-header">Impostazioni generali</h2>
          <div class="panel-content">
            <div
              class="slider-group"
              data-key="maxSources"
              data-target="config"
            >
              <label>Numero di sorgenti</label>
              <div class="slider-input-wrapper">
                <input type="range" min="1" max="20" step="1" value="5" />
                <input
                  type="number"
                  min="1"
                  max="20"
                  step="1"
                  value="5"
                  class="value-input"
                />
              </div>
            </div>
            <div
              class="slider-group"
              data-key="maxReflections"
              data-target="config"
            >
              <label>Numero di riflessioni</label>
              <div class="slider-input-wrapper">
                <input type="range" min="0" max="10" step="1" value="2" />
                <input
                  type="number"
                  min="0"
                  max="10"
                  step="1"
                  value="2"
                  class="value-input"
                />
              </div>
            </div>
          </div>
        </div>

        <div class="ui-panel">
          <h2 class="panel-header">Formato</h2>
          <div class="panel-content">
            <div class="preset-group">
              <select id="format-select">
                <option value="viewport" selected>
                  Superficie di visualizzazione
                </option>
                <option value="595x842">Stampa: A4 (Verticale)</option>
                <option value="842x1191">Stampa: A3 (Verticale)</option>
                <option value="842x595">Stampa: A4 (Orizzontale)</option>
                <option value="1191x842">Stampa: A3 (Orizzontale)</option>
                <option value="1080x1350">Social: Post Instagram (4:5)</option>
                <option value="1080x1920">
                  Social: Storia Instagram (9:16)
                </option>
                <option value="1200x630">Social: Post Facebook</option>
                <option value="1920x1080">Web: Grande (16:9)</option>
                <option value="1024x768">Web: Piccolo (4:3)</option>
                <option value="custom">-- Formato Personalizzato --</option>
              </select>
            </div>
            <div id="custom-format-inputs" class="hidden">
              <div class="input-group">
                <label for="custom-width">Larghezza (px)</label>
                <input type="number" id="custom-width" value="595" />
              </div>
              <div class="input-group">
                <label for="custom-height">Altezza (px)</label>
                <input type="number" id="custom-height" value="842" />
              </div>
            </div>
            <div class="preset-group">
              <button id="apply-format-btn">Applica formato</button>
            </div>
          </div>
        </div>

        <div class="ui-panel">
          <h2 class="panel-header">Visibilità onde</h2>
          <div class="panel-content">
            <div class="preset-group">
              <label for="wave-display-select">Mostra onde</label>
              <select id="wave-display-select">
                <option value="both" selected>Entrambe le onde</option>
                <option value="primary">Solo onde primarie</option>
                <option value="secondary">Solo onde secondarie</option>
              </select>
            </div>
          </div>
        </div>

        <div class="ui-panel">
          <h2 class="panel-header">Zoom</h2>
          <div class="panel-content">
            <div class="preset-group">
              <label for="zoom-select">Livello zoom</label>
              <select id="zoom-select">
                <option value="fit">Adatta allo schermo</option>
                <option value="0.25">25%</option>
                <option value="0.5">50%</option>
                <option value="0.75">75%</option>
                <option value="1" selected>100% (Default)</option>
                <option value="1.5">150%</option>
                <option value="2">200%</option>
                <option value="4">400%</option>
              </select>
              <button id="apply-zoom-btn">Applica zoom</button>
            </div>
          </div>
        </div>

        <div class="ui-panel">
          <h2 class="panel-header">Onde primarie</h2>
          <div class="panel-content">
            <div
              class="slider-group"
              data-key="maxWavesPrimary"
              data-target="config"
            >
              <label>Numero onde</label>
              <div class="slider-input-wrapper">
                <input type="range" min="1" max="20" step="1" value="5" />
                <input
                  type="number"
                  min="1"
                  max="20"
                  step="1"
                  value="5"
                  class="value-input"
                />
              </div>
            </div>
            <div
              class="slider-group"
              data-key="speedPrimary"
              data-target="config"
            >
              <label>Velocità</label>
              <div class="slider-input-wrapper">
                <input type="range" min="1" max="200" step="1" value="30" />
                <input
                  type="number"
                  min="1"
                  max="200"
                  step="1"
                  value="30"
                  class="value-input"
                />
              </div>
            </div>
            <div
              class="slider-group"
              data-key="intervalPrimary"
              data-target="config"
            >
              <label>Frequenza</label>
              <div class="slider-input-wrapper">
                <input
                  type="range"
                  min="0.05"
                  max="2"
                  step="0.01"
                  value="0.3"
                />
                <input
                  type="number"
                  min="0.05"
                  max="2"
                  step="0.01"
                  value="0.3"
                  class="value-input"
                />
              </div>
            </div>
            <div
              class="slider-group"
              data-key="alphaPrimary"
              data-target="config"
            >
              <label>Opacità</label>
              <div class="slider-input-wrapper">
                <input
                  type="range"
                  min="0.01"
                  max="1"
                  step="0.01"
                  value="0.8"
                />
                <input
                  type="number"
                  min="0.01"
                  max="1"
                  step="0.01"
                  value="0.8"
                  class="value-input"
                />
              </div>
            </div>
            <div
              class="slider-group"
              data-key="decayFactorPrimary"
              data-target="config"
            >
              <label>Durata</label>
              <div class="slider-input-wrapper">
                <input type="range" min="0.1" max="5" step="0.1" value="1.5" />
                <input
                  type="number"
                  min="0.1"
                  max="5"
                  step="0.1"
                  value="1.5"
                  class="value-input"
                />
              </div>
            </div>
            <div
              class="slider-group"
              data-key="heartSizePrimary"
              data-target="config"
            >
              <label>Dimensione</label>
              <div class="slider-input-wrapper">
                <input type="range" min="0.1" max="3" step="0.05" value="1" />
                <input
                  type="number"
                  min="0.1"
                  max="3"
                  step="0.05"
                  value="1"
                  class="value-input"
                />
              </div>
            </div>
            <div
              class="slider-group"
              data-key="strokePrimary"
              data-target="config"
            >
              <label>Spessore</label>
              <div class="slider-input-wrapper">
                <input type="range" min="1" max="200" step="1" value="80" />
                <input
                  type="number"
                  min="1"
                  max="200"
                  step="1"
                  value="80"
                  class="value-input"
                />
              </div>
            </div>
          </div>
        </div>

        <div class="ui-panel">
          <h2 class="panel-header">Onde secondarie</h2>
          <div class="panel-content">
            <div
              class="slider-group"
              data-key="maxWavesSecondary"
              data-target="config"
            >
              <label>Numero Onde</label>
              <div class="slider-input-wrapper">
                <input type="range" min="1" max="20" step="1" value="5" />
                <input
                  type="number"
                  min="1"
                  max="20"
                  step="1"
                  value="5"
                  class="value-input"
                />
              </div>
            </div>
            <div
              class="slider-group"
              data-key="speedSecondary"
              data-target="config"
            >
              <label>Velocità</label>
              <div class="slider-input-wrapper">
                <input type="range" min="1" max="200" step="1" value="30" />
                <input
                  type="number"
                  min="1"
                  max="200"
                  step="1"
                  value="30"
                  class="value-input"
                />
              </div>
            </div>
            <div
              class="slider-group"
              data-key="intervalSecondary"
              data-target="config"
            >
              <label>Frequenza</label>
              <div class="slider-input-wrapper">
                <input
                  type="range"
                  min="0.05"
                  max="2"
                  step="0.01"
                  value="0.2"
                />
                <input
                  type="number"
                  min="0.05"
                  max="2"
                  step="0.01"
                  value="0.2"
                  class="value-input"
                />
              </div>
            </div>
            <div
              class="slider-group"
              data-key="alphaSecondary"
              data-target="config"
            >
              <label>Opacità</label>
              <div class="slider-input-wrapper">
                <input
                  type="range"
                  min="0.01"
                  max="1"
                  step="0.01"
                  value="0.8"
                />
                <input
                  type="number"
                  min="0.01"
                  max="1"
                  step="0.01"
                  value="0.8"
                  class="value-input"
                />
              </div>
            </div>
            <div
              class="slider-group"
              data-key="decayFactorSecondary"
              data-target="config"
            >
              <label>Durata</label>
              <div class="slider-input-wrapper">
                <input type="range" min="0.1" max="5" step="0.1" value="1.5" />
                <input
                  type="number"
                  min="0.1"
                  max="5"
                  step="0.1"
                  value="1.5"
                  class="value-input"
                />
              </div>
            </div>
            <div
              class="slider-group"
              data-key="heartSizeSecondary"
              data-target="config"
            >
              <label>Dimensione</label>
              <div class="slider-input-wrapper">
                <input type="range" min="0.1" max="3" step="0.05" value="1" />
                <input
                  type="number"
                  min="0.1"
                  max="3"
                  step="0.05"
                  value="1"
                  class="value-input"
                />
              </div>
            </div>
            <div
              class="slider-group"
              data-key="strokeSecondary"
              data-target="config"
            >
              <label>Spessore</label>
              <div class="slider-input-wrapper">
                <input type="range" min="1" max="200" step="1" value="20" />
                <input
                  type="number"
                  min="1"
                  max="200"
                  step="1"
                  value="20"
                  class="value-input"
                />
              </div>
            </div>
          </div>
        </div>

        <div class="ui-panel">
          <h2 class="panel-header">Stile & esporta</h2>
          <div class="panel-content">
            <div class="color-picker-group">
              <label>Colore Sfondo</label>
              <div class="color-input-wrapper">
                <input
                  type="color"
                  id="bg-picker"
                  data-key="bg"
                  data-target="pal"
                />
                <input type="text" id="bg-hex" class="hex-input" />
              </div>
<div class="bg-mode-group">
  <label>Tipo Sfondo</label>
  <div class="bg-mode-options">
    <label><input type="radio" name="bg-mode" value="color" id="bg-mode-color" checked /> Colore</label>
    <label><input type="radio" name="bg-mode" value="image" id="bg-mode-image" /> Immagine</label>
  </div>
</div>

<div class="file-picker-group" id="bg-file-group" style="display:none">
  <label>Carica immagine (jpg, jpeg, png, webp, svg, pdf)</label>
  <input type="file" id="bg-file" accept=".jpg,.jpeg,.png,.webp,.svg,.pdf,image/*,application/pdf" />
  <div class="field-row" style="margin-top:8px">
    <label>Adatta canvas all’immagine</label>
    <label class="switch">
      <input type="checkbox" id="bg-autosize" checked />
      <span class="slider"></span>
    </label>
  </div>
  <div class="bg-file-actions">
    <button id="bg-clear-btn" class="secondary">Rimuovi immagine</button>
  </div>
  <p 
  <div class="field-row">
    <label>Carica da URL</label>
    <div class="bg-url-row">
      <input type="url" id="bg-url" placeholder="https://…/immagine.jpg, .png, .webp, .svg" />
      <button id="bg-url-load" class="secondary">Carica</button>
    </div>
  </div>

  <div class="field-row">
    <label>Adattamento immagine</label>
    <select id="bg-fit">
      <option value="contain">Contain (tutto visibile)</option>
      <option value="cover">Cover (riempi, può tagliare)</option>
      <option value="stretch">Stretch (deforma)</option>
      <option value="center">Center (senza scalare)</option>
      <option value="tile">Tile (ripeti)</option>
    </select>
  <div class="field-row">
    <label>Opacità immagine (%)</label>
    <div class="bg-opacity-row">
      <input type="range" id="bg-opacity" min="0" max="100" value="100" />
      <input type="number" id="bg-opacity-num" min="0" max="100" value="100" />
    </div>
  </div>
  <div class="field-row">
    <label>Opacità blur (%)</label>
    <div class="bg-opacity-row">
      <input type="range" id="bg-blur-opacity" min="0" max="100" value="60" />
      <input type="number" id="bg-blur-opacity-num" min="0" max="100" value="60" />
    </div>
  </div>


  <div class="field-row">
    <label>Fill con blur</label>
    <label class="switch">
      <input type="checkbox" id="bg-fill-blur" />
      <span class="slider"></span>
    </label>
  </div>
  <div class="field-row" id="bg-blur-row" style="display:none">
    <label>Intensità blur</label>
    <input type="number" id="bg-blur" min="0" max="50" value="12" />
  </div>

  <div class="field-row">
    <label>Posizionamento</label>
    <select id="bg-anchor">
      <option value="center">Centro</option>
      <option value="top-left">Alto-Sinistra</option>
      <option value="top">Alto</option>
      <option value="top-right">Alto-Destra</option>
      <option value="left">Sinistra</option>
      <option value="right">Destra</option>
      <option value="bottom-left">Basso-Sinistra</option>
      <option value="bottom">Basso</option>
      <option value="bottom-right">Basso-Destra</option>
    </select>
  </div>

  <div class="grid-2">
    <div class="field-row">
      <label>Offset X (px)</label>
      <input type="number" id="bg-offset-x" value="0" step="1" />
    </div>
    <div class="field-row">
      <label>Offset Y (px)</label>
      <input type="number" id="bg-offset-y" value="0" step="1" />
    </div>
  </div>

  </div>

  <div class="field-row">
    <label>Blocca dimensioni canvas</label>
    <label class="switch">
      <input type="checkbox" id="bg-lock-canvas" />
      <span class="slider"></span>
    </label>
  </div>

  <div class="field-row" id="bg-tile-scale-row" style="display:none">
    <label>Scala tile (%)</label>
    <input type="number" id="bg-tile-scale" min="10" max="400" step="10" value="100" />
  </div>

  <div class="bg-presets">
    <div class="bg-presets__head">
      <strong>Preset Sfondo</strong>
      <div class="spacer"></div>
      <button id="bg-preset-save" class="secondary">Salva preset</button>
    </div>
    <div class="bg-presets__save-row">
      <input type="text" id="bg-preset-name" placeholder="Nome preset…" />
      <label class="embed-check"><input type="checkbox" id="bg-preset-embed" checked /> Incorpora immagine (DataURL)</label>
    </div>
    <div id="bg-presets-list" class="bg-presets__list"></div>
  </div>
</div>


            </div>
            <div class="color-picker-group">
              <label>Colore primario</label>
              <div class="color-input-wrapper">
                <input
                  type="color"
                  id="stroke-picker"
                  data-key="stroke"
                  data-target="pal"
                />
                <input type="text" id="stroke-hex" class="hex-input" />
              </div>
            </div>
            <div class="color-picker-group">
              <label>Colore secondario</label>
              <div class="color-input-wrapper">
                <input
                  type="color"
                  id="stroke2-picker"
                  data-key="stroke2"
                  data-target="pal"
                />
                <input type="text" id="stroke2-hex" class="hex-input" />
              </div>
            </div>
            <div
              class="checkbox-group"
              data-key="saveBackground"
              data-target="config"
            >
              <label>
                <input type="checkbox" checked />
                Includi sfondo
              </label>
            </div>
            <div class="preset-group">
              <button id="save-png-btn">Esporta PNG</button>
            </div>
            <div
              class="preset-group"
              style="
                border-top: 1px solid var(--border-color);
                padding-top: 20px;
              "
            >
              <label>Esporta Animazione</label>
              <button id="record-video-btn">Registra Video (.webm)</button>
              <button id="save-sequence-btn" style="margin-top: 10px">
                Salva Sequenza (PNG)
              </button>
              <p
                id="export-status"
                style="
                  font-size: 12px;
                  color: var(--text-secondary);
                  margin-top: 10px;
                  text-align: center;
                  height: 15px;
                "
              ></p>
            </div>
          </div>
        </div>

        <footer>
          <div id="quick-controls">
            <button id="pause-btn">Pausa</button>
            <button id="clear-btn">Pulisci</button>
            <button id="reset-btn">Reset</button>
          </div>
          <div id="stats-display">
            <span>FPS: 0</span>
            <span>Sorgenti: 0</span>
            <span>Onde: 0</span>
          </div>
          <div id="shortcuts">
            <p>
              Shortcuts: [Spazio] Pausa | [C] Pulisci | [R] Reset | [S] Salva
            </p>
          </div>
        </footer>
      </aside>
    </main>
  </body>
</html>
